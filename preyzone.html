<!DOCTYPE html>
<html>
<head>
	<title>Preyzone</title>
	<script src="https://ajax.aspnetcdn.com/ajax/jQuery/jquery-3.1.1.min.js"></script>
</head>
<body>

<input name="accelerationSlider" id="accelerationSlider" type="range" min="0" max="1000" step="1" onchange="setAcceleration()" /> 
<label for="accelerationSlider" id="lblAccelerationSlider"></label>

<div id="mainContainer" class="mainContainer ratio1-1">
	<div id="innerContainer" class="innerContainer">
		<div id="target" class="ratio1-1 tar">
			<div class="filler" id="scoreDisplay"></div>
		</div>
		<div id="auxContainer">
			<div id="aux_1" class="ratio1-1 aux" >
				<div class="filler"></div>
			</div>
			<div id="aux_2" class="ratio1-1 aux" >
				<div class="filler"></div>
			</div>
			<div id="aux_3" class="ratio1-1 aux" >
				<div class="filler"></div>
			</div>
			<div id="aux_4" class="ratio1-1 aux" >
				<div class="filler"></div>
			</div>
		</div>
	</div>
</div>

<style type="text/css">
.mainContainer {
	background: #c0a489;
	position: absolute;
	display: inline-block;
	vertical-align: top;
    box-shadow: 0 0 4px rgba(0,0,0,.3);
}

.tar {
	width: 10%;
	border-radius: 20%;
    background: #C60000;
    position: absolute;
    display: inline-block;
    vertical-align: top;
    box-shadow: 0 0 4px rgba(0,0,0,.3);
}

.aux {
    width: 5%;
    border-radius: 50%;
    background: #F9D237;
    position: absolute;
    display: inline-block;
    vertical-align: top;
    box-shadow: 0 0 4px rgba(0,0,0,.3);
}


.aux:before, .tar:before, #mainContainer:before{
    content: '';
    display: block;
}
.ratio1-1:before {padding-top: 100%;}

.filler {    
   position: absolute;
   top: 0; left: 0; bottom: 0; right: 0;
   font-size: 1.5rem;
   color: #444;
}

.innerContainer{
	margin: 2.5%;
	position: absolute;
   	top: 0; left: 0; bottom: 0; right: 0;
   	font-size: 1.5rem;
   	color: #444;
}

#auxContainer{
	height: 100%;
	width: 100%;
	transform-origin: center center;
}

</style>

<script type="text/javascript">
	var rotationSpeed = 15; //RPM with acceleration set to false
	var refreshSpeed = 35//RfrPS
	var accelerationPr = 100; //% per Revolution
	var debug = false; //may cause animation go slow
	var angleRaw = 0;
	var pointCounter = 0;
	var tryCounter = 0;

	rotationSpeed = ((rotationSpeed / 60) * 360); //degs per sec
	acceleration = accelerationPr / 100; //coeficiente

	$(function()
		{
			spawnSquares();
		});
	$(window).resize(function()
		{
			spawnSquares();
		});

	$('body').keydown(function(e)
	{
		if(e.keyCode == 32)
		{
			e.preventDefault(); //stops browser from scrolling
			validateFire();
		}
	});

	function setAcceleration()
	{
		var acc = $("#accelerationSlider").val();
		$("#lblAccelerationSlider").text(acc + "%");
		acceleration = acc / 100;
	}

	function spawnSquares()
	{
		setTarget();
		
		var vh = $(window).height();
		var vw = $(window).width();
		
		var dynamicPercent = 10;
		
		var resultW = parseInt(vh - (vh * (dynamicPercent / 100)));
		var resultL = parseInt(vw - (vw / 2) - (resultW / 2));
		var resultMT = parseInt(vh * 0.01);
		
		var resultW_vertical = parseInt(vw - (vw * (dynamicPercent / 100)));
		var resultL_vertical = parseInt(vw - (vw / 2) - (resultW_vertical / 2));
		var resultMT_vertical = parseInt(vw * 0.01);
		
		//Vertical orientation support for Cordova/Phonegap porting
		if(vw > vh)
		{
			$("#mainContainer").css("width", resultW + "px");
			$("#mainContainer").css("left", resultL + "px");
			$("#mainContainer").css("margin-top", resultMT + "px");
		}
		else
		{
			$("#mainContainer").css("width", resultW_vertical + "px");
			$("#mainContainer").css("left", resultL_vertical + "px");
			$("#mainContainer").css("margin-top", resultMT_vertical + "px");
		}

		for(i = 0; i < 4; i++)
		{
			setAux(i + 1);
		}
	}

	function validateFire()
	{
		if(((angleRaw % 90) < 10) || ((angleRaw % 90) > 80))
		{
			pointCounter++;
		}
		tryCounter++;
		$("#scoreDisplay").html(pointCounter + " - " + tryCounter);
	}

	setInterval(function()
	{
		var initialAngle = angleRaw;
		if(debug == true) { console.log("inAn " + initialAngle); }
		phaseFactor = ((((initialAngle * 100) / 360) / 100)); //need +1 to realy be a factor
		triangularPhaseFactor  = (angleRaw < 180) ? (phaseFactor * 2) : (1 - phaseFactor ); //same as phaseFactor
		if(debug == true) { console.log("tpf " + triangularPhaseFactor); }
		if(debug == true) { console.log("pf " + phaseFactor); }
		//if(acceleration != 0) { phaseFactor = phaseFactor * (acceleration + 1); }

		nativeIncreaseRatio = (rotationSpeed / refreshSpeed);
		triangularIncreaseRatio = nativeIncreaseRatio * (1 + triangularPhaseFactor);
		//angleRaw = (angleRaw * (1 + phaseFactor));
		if(debug == true) { console.log("na " + nativeIncreaseRatio); }
	

		angleRaw = ((initialAngle + triangularIncreaseRatio) % 360);
		if(debug == true) { console.log("fAraw " + angleRaw); }
    	var angle = parseInt(angleRaw);
    	if(debug == true) { console.log("angle " + angle); }
	    setRotationPosition(angle);

	},
	(1000 / refreshSpeed));

	function setRotationPosition(angle)
	{
		$("#auxContainer")
		    .css('-webkit-transform', 'rotate('+angle+'deg)')
	        .css('-moz-transform', 'rotate('+angle+'deg)')
	        .css('-ms-transform', 'rotate('+angle+'deg)');
	}

	function setTarget()
	{
		var target = $("#target");
		target.css("top", "45%");
    	target.css("left", "45%");
	}

	function setAux(aux)
	{
		var target = $("#aux_" + aux);
		target.css("transform-origin", "center center");
		switch(aux)
		{
			case 1:
				target.css("top", "0%");
    			target.css("left", "50%");
    			target.css("background", "#6537F9");
				break;
			case 2:
				target.css("top", "50%");
    			target.css("left", "95%");
				break;
	    	case 3:
				target.css("top", "95%");
    			target.css("left", "50%");
				break;
	    	case 4:
				target.css("top", "50%");
    			target.css("left", "0%");
				break;

		}
	}


</script>

</body>
</html>